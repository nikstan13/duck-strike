<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Duck Strike - Soccer Pool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #ffa797;
            font-family: Arial, sans-serif;
            overflow: hidden;
            margin: 0;
            padding: 0;
            position: relative;
            touch-action: none;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ffa797;
            z-index: -1;
        }
        
        /* ÎšÏÏÏˆÎµ ÏŒÎ»Î± Ï„Î± error messages */
        body > *:not(canvas):not(#fullscreenBtn) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        #gameCanvas {
            display: block !important;
            position: relative;
            max-width: 100vw;
            max-height: 100vh;
            width: 1600px;
            height: 900px;
        }

        /* Fullscreen button */
        #fullscreenBtn {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 2px solid white;
            border-radius: 10px;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        #fullscreenBtn:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.05);
        }

        #fullscreenBtn:active {
            transform: scale(0.95);
        }

        /* Hide button on desktop */
        @media (min-width: 1024px) {
            #fullscreenBtn {
                display: none !important;
            }
        }

        /* Fullscreen styles */
        #gameCanvas:-webkit-full-screen {
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
        }

        #gameCanvas:-moz-full-screen {
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
        }

        #gameCanvas:fullscreen {
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
        }

        @media (max-width: 1600px) {
            #gameCanvas {
                width: 100vw;
                height: auto;
            }
        }

        @media (orientation: portrait) {
            body {
                overflow: auto;
            }
            #gameCanvas {
                width: 100vw;
                height: auto;
            }
        }

        #gameCanvas {
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            cursor: pointer;
            max-width: 100%;
            max-height: 100vh;
            display: block;
        }

        .controls {
            display: none; /* Î‘Ï€ÏŒÎºÏÏ…ÏˆÎ· Î¿Î´Î·Î³Î¹ÏÎ½ */
        }

        .controls h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .controls p {
            margin: 5px 0;
            color: #666;
        }
    </style>
</head>
<body>
    <button id="fullscreenBtn">â›¶ Fullscreen</button>
    
    <div class="controls">
        <h3>ğŸ® ÎŸÎ´Î·Î³Î¯ÎµÏ‚</h3>
        <p>ğŸ–±ï¸ ÎšÎ»Î¹Îº ÏƒÎµ ÎºÏŒÎºÎºÎ¹Î½Î¿ Ï€Î±Î¯ÎºÏ„Î·</p>
        <p>â†”ï¸ Î¤ÏÎ¬Î²Î·Î¾Îµ Ï€ÏÎ¿Ï‚ Ï„Î·Î½ Î‘ÎÎ¤Î™Î˜Î•Î¤Î— ÎºÎ±Ï„ÎµÏÎ¸Ï…Î½ÏƒÎ·</p>
        <p>ğŸš€ ÎŒÏƒÎ¿ Ï€Î¹Î¿ Ï€Î¿Î»Ï Ï„ÏÎ±Î²Î®Î¾ÎµÎ¹Ï‚ = Ï€Î¹Î¿ Î´Ï…Î½Î±Ï„Î¬!</p>
        <p>âš½ Î£ÎºÏŒÏÎ±ÏÎµ Î³ÎºÎ¿Î» ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î± Ï„Î¿Ï… BOT!</p>
    </div>    <canvas id="gameCanvas" width="1600" height="900"></canvas>

    <script>
        console.log('Script started!');
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        console.log('Canvas:', canvas);
        console.log('Canvas size:', canvas.width, 'x', canvas.height);

        // Fullscreen functionality
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        
        function toggleFullscreen() {
            if (!document.fullscreenElement && 
                !document.webkitFullscreenElement && 
                !document.mozFullScreenElement) {
                // Enter fullscreen - Use document.documentElement for better compatibility
                const elem = document.documentElement;
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.mozRequestFullScreen) {
                    elem.mozRequestFullScreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
                fullscreenBtn.textContent = 'âœ• Exit';
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                fullscreenBtn.textContent = 'â›¶ Full';
            }
        }
        
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        fullscreenBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            toggleFullscreen();
        });
        
        // Update button text on fullscreen change
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                fullscreenBtn.textContent = 'â›¶ Full';
            } else {
                fullscreenBtn.textContent = 'âœ• Exit';
            }
        });
        
        document.addEventListener('webkitfullscreenchange', () => {
            if (!document.webkitFullscreenElement) {
                fullscreenBtn.textContent = 'â›¶ Full';
            } else {
                fullscreenBtn.textContent = 'âœ• Exit';
            }
        });
        
        document.addEventListener('mozfullscreenchange', () => {
            if (!document.mozFullScreenElement) {
                fullscreenBtn.textContent = 'â›¶ Full';
            } else {
                fullscreenBtn.textContent = 'âœ• Exit';
            }
        });

        // Î§ÏÏÎ¼Î±Ï„Î±
        const COLORS = {
            green: '#00C853',  // Î Î¹Î¿ Î¶Ï‰Î½Ï„Î±Î½ÏŒ, Ï†Ï‰Ï„ÎµÎ¹Î½ÏŒ Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ (Î±Ï€ÏŒ #4caf50)
            white: '#ffffff',
            black: '#000000',
            red: '#f44336',
            blue: '#2196f3',
            cyan: '#00e5ff',
            orange: '#ffa797',
            darkGrey: '#424242',
            lightBlue: '#64b5f6',
            lightRed: '#ff8a80'
        };

        // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ÎµÎ¹ÎºÏŒÎ½Ï‰Î½
        const images = {
            duckRed: new Image(),
            duckBlue: new Image()
        };
        
        images.duckRed.src = './assets/duck_red.png';
        images.duckBlue.src = './assets/duck_blue.png';
        
        // Î‘Î½Î±Î¼Î¿Î½Î® Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ ÎµÎ¹ÎºÏŒÎ½Ï‰Î½
        let imagesLoaded = 0;
        const totalImages = 2;
        
        images.duckRed.onload = () => {
            imagesLoaded++;
            console.log('Duck Red loaded!');
            if (imagesLoaded === totalImages) startGame();
        };
        
        images.duckBlue.onload = () => {
            imagesLoaded++;
            console.log('Duck Blue loaded!');
            if (imagesLoaded === totalImages) startGame();
        };
        
        images.duckRed.onerror = () => {
            console.error('Failed to load duck_red.png - Check path: ./assets/duck_red.png');
        };
        
        images.duckBlue.onerror = () => {
            console.error('Failed to load duck_blue.png - Check path: ./assets/duck_blue.png');
        };

        // ÎœÏ€Î¬Î»Î±
        class Ball {
            constructor() {
                this.reset();
                this.radius = 15;
                this.friction = 0.97;  // Î‘Ï…Î¾Î·Î¼Î­Î½Î· Ï„ÏÎ¹Î²Î® (Î±Ï€ÏŒ 0.98)
                this.firstShotAfterReset = true;  // Flag Î³Î¹Î± Ï€ÏÏÏ„Î¿ shot Î¼ÎµÏ„Î¬ reset
                this.inGoal = false;  // Flag Î±Î½ Î· Î¼Ï€Î¬Î»Î± ÎµÎ¯Î½Î±Î¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î±
                this.goalType = null;  // Î¤ÏÏ€Î¿Ï‚ Î³ÎºÎ¿Î» ('player_goal', 'bot_goal', ÎºÏ„Î»)
                this.goalTime = 0;  // Î§ÏÏŒÎ½Î¿Ï‚ Ï€Î¿Ï… Î¼Ï€Î®ÎºÎµ Î³ÎºÎ¿Î»
            }

            reset() {
                // ÎšÎ­Î½Ï„ÏÎ¿ Ï„Î¿Ï… Î³Î·Ï€Î­Î´Î¿Ï… (ÏŒÏ‡Î¹ Ï„Î¿Ï… canvas)
                const topMargin = 180;
                const bottomMargin = 80;
                this.x = canvas.width / 2;
                this.y = (topMargin + (canvas.height - bottomMargin)) / 2;  // ÎšÎ­Î½Ï„ÏÎ¿ Î³Î·Ï€Î­Î´Î¿Ï…
                this.vx = 0;
                this.vy = 0;
                this.firstShotAfterReset = true;  // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ flag Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ reset
                this.inGoal = false;
                this.goalType = null;
                this.goalTime = 0;
            }

            update() {
                // Î‘Î½ Î· Î¼Ï€Î¬Î»Î± ÎµÎ¯Î½Î±Î¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î±, ÎµÏ€Î¹Î²ÏÎ¬Î´Ï…Î½ÏƒÎ· Î´ÏÎ±Î¼Î±Ï„Î¹ÎºÎ® (Î´Î¯Ï‡Ï„Ï…)
                if (this.inGoal) {
                    this.vx *= 0.75;  // Î‘ÎºÏŒÎ¼Î± Ï€Î¹Î¿ Î¼ÎµÎ³Î¬Î»Î· ÎµÏ€Î¹Î²ÏÎ¬Î´Ï…Î½ÏƒÎ·
                    this.vy *= 0.75;
                    
                    // Î‘Î½ Î· Ï„Î±Ï‡ÏÏ„Î·Ï„Î± ÎµÎ¯Î½Î±Î¹ Ï€Î¿Î»Ï Î¼Î¹ÎºÏÎ®, ÏƒÏ„Î±Î¼Î¬Ï„Î± ÎµÎ½Ï„ÎµÎ»ÏÏ‚
                    if (Math.abs(this.vx) < 0.5) this.vx = 0;
                    if (Math.abs(this.vy) < 0.5) this.vy = 0;
                    
                    // ÎœÎµÏ„Î¬ Î±Ï€ÏŒ 0.5 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±, ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î® Ï„Î¿Ï… goalType
                    if (Date.now() - this.goalTime >= 500) {
                        return this.goalType;  // Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® Ï„Î¿Ï… Ï„ÏÏ€Î¿Ï… Î³ÎºÎ¿Î»
                    }
                }
                
                // Sub-stepping Î³Î¹Î± Ï€Î¹Î¿ Î±ÎºÏÎ¹Î²Î® collision detection
                const substeps = 5;
                
                for (let i = 0; i < substeps; i++) {
                    this.x += this.vx / substeps;
                    this.y += this.vy / substeps;
                    
                    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î¿ÏÎ¯Ï‰Î½ ÎœÎ•Î£Î‘ ÏƒÏ„Î¿ substep loop Î³Î¹Î± Ï€Î¹Î¿ Î±ÎºÏÎ¹Î²Î® detection
                    this.checkBoundaries();
                }
                
                // Easing function - Exponential decay Î³Î¹Î± Ï€Î¹Î¿ Ï†Ï…ÏƒÎ¹ÎºÎ® ÎµÏ€Î¹Î²ÏÎ¬Î´Ï…Î½ÏƒÎ·
                if (!this.inGoal) {  // ÎœÏŒÎ½Î¿ Î±Î½ Î”Î•Î ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î±
                    const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                    
                    if (speed > 0.1) {
                        const decayFactor = Math.pow(this.friction, 1.2);
                        this.vx *= decayFactor;
                        this.vy *= decayFactor;
                    } else {
                        this.vx = 0;
                        this.vy = 0;
                    }
                }

                return null;
            }

            checkBoundaries() {
                // ÎÎ­Î± ÏŒÏÎ¹Î± Î³Î·Ï€Î­Î´Î¿Ï…
                const sideMargin = 240;
                const topMargin = 180;
                const bottomMargin = 80;
                
                // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î¸Î­ÏƒÎ·Ï‚ ÎºÎ­Î½Ï„ÏÎ¿Ï… Î³Î¹Î± Ï„Î¿Ï…Ï‚ ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚
                const centerX = canvas.width / 2;
                const centerY = (topMargin + (canvas.height - bottomMargin)) / 2;
                
                // Î£ÏÎ½Î¿ÏÎ± Ï€Î¬Î½Ï‰-ÎºÎ¬Ï„Ï‰
                if (this.y - this.radius < topMargin) {
                    this.y = topMargin + this.radius;
                    this.vy *= -0.6;
                } else if (this.y + this.radius > canvas.height - bottomMargin) {
                    this.y = canvas.height - bottomMargin - this.radius;
                    this.vy *= -0.6;
                }

                // Î¤Î­ÏÎ¼Î±Ï„Î± - Î‘ÏÎ¹ÏƒÏ„ÎµÏÎ¬ ÎºÎ±Î¹ Î”ÎµÎ¾Î¹Î¬ - Î— Î¼Ï€Î¬Î»Î± Î¼Ï€Î±Î¯Î½ÎµÎ¹ Î¼Î­ÏƒÎ±!
                const fieldCenterY = (topMargin + (canvas.height - bottomMargin)) / 2;
                const goalHeight = 180;
                const goalTop = fieldCenterY - (goalHeight / 2);
                const goalBottom = fieldCenterY + (goalHeight / 2);
                const goalDepth = 60;  // Î’Î¬Î¸Î¿Ï‚ Ï„Î­ÏÎ¼Î±Ï„Î¿Ï‚ (Ï€ÏŒÏƒÎ¿ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¼Ï€ÎµÎ¹ Î· Î¼Ï€Î¬Î»Î± Ï€Î¯ÏƒÏ‰)
                
                // Î‘ÏÎ¹ÏƒÏ„ÎµÏÏŒ Ï„Î­ÏÎ¼Î± (Player ÏƒÎºÎ¿ÏÎ¬ÏÎµÎ¹) - ÎŸÎ»ÏŒÎºÎ»Î·ÏÎ· Î· Î¼Ï€Î¬Î»Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€ÎµÏÎ¬ÏƒÎµÎ¹
                if (this.x + this.radius < sideMargin && this.y > goalTop && this.y < goalBottom) {  
                    // ÎœÏ€Î¬Î»Î± Î¼Ï€Î®ÎºÎµ ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î±!
                    if (!this.inGoal) {  // Î ÏÏÏ„Î· Ï†Î¿ÏÎ¬ Ï€Î¿Ï… Î¼Ï€Î±Î¯Î½ÎµÎ¹
                        this.inGoal = true;
                        this.goalTime = Date.now();
                        
                        // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î¦Î‘ÎŸÎ¥Î›
                        if (this.firstShotAfterReset) {
                            this.goalType = 'foul_player_goal';
                        } else {
                            this.goalType = 'player_goal';
                        }
                    }
                    
                    // ÎŒÏÎ¹Î¿ Ï€Î¯ÏƒÏ‰ Î³ÏÎ±Î¼Î¼Î®Ï‚ Ï„Î­ÏÎ¼Î±Ï„Î¿Ï‚ (Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬) - Î£Î¤Î‘ÎœÎ‘Î¤Î‘ Î•Î”Î©!
                    const backLine = sideMargin - goalDepth;
                    if (this.x - this.radius <= backLine) {
                        this.x = backLine + this.radius;
                        this.vx = 0;  // Î Î›Î—Î¡Î—Î£ Î£Î¤Î‘Î£Î—
                        this.vy = 0;  // Î Î›Î—Î¡Î—Î£ Î£Î¤Î‘Î£Î— ÎºÎ±Î¹ ÎºÎ±Ï„Î±ÎºÏŒÏÏ…Ï†Î±
                    }
                    
                    // ÎŒÏÎ¹Î± Ï€Î¬Î½Ï‰-ÎºÎ¬Ï„Ï‰ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î± - Î£ÎšÎ›Î—Î¡Î‘ ÎŸÎ¡Î™Î‘
                    if (this.y - this.radius <= goalTop) {
                        this.y = goalTop + this.radius;
                        this.vy = 0;  // Î Î›Î—Î¡Î—Î£ Î£Î¤Î‘Î£Î—
                    }
                    if (this.y + this.radius >= goalBottom) {
                        this.y = goalBottom - this.radius;
                        this.vy = 0;  // Î Î›Î—Î¡Î—Î£ Î£Î¤Î‘Î£Î—
                    }
                    
                    return;  // ÎŒÏ‡Î¹ null, Î±Ï€Î»Î¬ return
                }
                
                // Bounce Î±Ï€ÏŒ Ï„Î¿Î½ Î±ÏÎ¹ÏƒÏ„ÎµÏÏŒ Ï„Î¿Î¯Ï‡Î¿ (ÎµÎºÏ„ÏŒÏ‚ Ï„Î­ÏÎ¼Î±Ï„Î¿Ï‚)
                if (this.x - this.radius < sideMargin && this.x + this.radius >= sideMargin) {
                    if (this.y < goalTop || this.y > goalBottom) {
                        this.x = sideMargin + this.radius;
                        this.vx *= -0.6;
                    }
                }
                
                // Î”ÎµÎ¾Î¯ Ï„Î­ÏÎ¼Î± (Bot ÏƒÎºÎ¿ÏÎ¬ÏÎµÎ¹) - ÎŸÎ»ÏŒÎºÎ»Î·ÏÎ· Î· Î¼Ï€Î¬Î»Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€ÎµÏÎ¬ÏƒÎµÎ¹
                if (this.x - this.radius > canvas.width - sideMargin && this.y > goalTop && this.y < goalBottom) {  
                    // ÎœÏ€Î¬Î»Î± Î¼Ï€Î®ÎºÎµ ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î±!
                    if (!this.inGoal) {  // Î ÏÏÏ„Î· Ï†Î¿ÏÎ¬ Ï€Î¿Ï… Î¼Ï€Î±Î¯Î½ÎµÎ¹
                        this.inGoal = true;
                        this.goalTime = Date.now();
                        
                        // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î¦Î‘ÎŸÎ¥Î›
                        if (this.firstShotAfterReset) {
                            this.goalType = 'foul_bot_goal';
                        } else {
                            this.goalType = 'bot_goal';
                        }
                    }
                    
                    // ÎŒÏÎ¹Î¿ Ï€Î¯ÏƒÏ‰ Î³ÏÎ±Î¼Î¼Î®Ï‚ Ï„Î­ÏÎ¼Î±Ï„Î¿Ï‚ (Î´ÎµÎ¾Î¹Î¬) - Î£Î¤Î‘ÎœÎ‘Î¤Î‘ Î•Î”Î©!
                    const backLine = canvas.width - sideMargin + goalDepth;
                    if (this.x + this.radius >= backLine) {
                        this.x = backLine - this.radius;
                        this.vx = 0;  // Î Î›Î—Î¡Î—Î£ Î£Î¤Î‘Î£Î—
                        this.vy = 0;  // Î Î›Î—Î¡Î—Î£ Î£Î¤Î‘Î£Î— ÎºÎ±Î¹ ÎºÎ±Ï„Î±ÎºÏŒÏÏ…Ï†Î±
                    }
                    
                    // ÎŒÏÎ¹Î± Ï€Î¬Î½Ï‰-ÎºÎ¬Ï„Ï‰ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î± - Î£ÎšÎ›Î—Î¡Î‘ ÎŸÎ¡Î™Î‘
                    if (this.y - this.radius <= goalTop) {
                        this.y = goalTop + this.radius;
                        this.vy = 0;  // Î Î›Î—Î¡Î—Î£ Î£Î¤Î‘Î£Î—
                    }
                    if (this.y + this.radius >= goalBottom) {
                        this.y = goalBottom - this.radius;
                        this.vy = 0;  // Î Î›Î—Î¡Î—Î£ Î£Î¤Î‘Î£Î—
                    }
                    
                    return;  // ÎŒÏ‡Î¹ null, Î±Ï€Î»Î¬ return
                }
                
                // Bounce Î±Ï€ÏŒ Ï„Î¿Î½ Î´ÎµÎ¾Î¯ Ï„Î¿Î¯Ï‡Î¿ (ÎµÎºÏ„ÏŒÏ‚ Ï„Î­ÏÎ¼Î±Ï„Î¿Ï‚)
                if (this.x + this.radius > canvas.width - sideMargin && this.x - this.radius <= canvas.width - sideMargin) {
                    if (this.y < goalTop || this.y > goalBottom) {
                        this.x = canvas.width - sideMargin - this.radius;
                        this.vx *= -0.6;
                    }
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = COLORS.black;
                ctx.fill();
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius - 3, 0, Math.PI * 2);
                ctx.fillStyle = COLORS.white;
                ctx.fill();
            }
        }

        // Î Î±Î¯ÎºÏ„Î·Ï‚
        class Player {
            constructor(x, y, color, isBot = false) {
                this.x = x;
                this.y = y;
                this.startX = x;  // Î‘ÏÏ‡Î¹ÎºÎ® Î¸Î­ÏƒÎ· (ÏƒÏ„Î±Î¸ÎµÏÎ®)
                this.startY = y;  // Î‘ÏÏ‡Î¹ÎºÎ® Î¸Î­ÏƒÎ· (ÏƒÏ„Î±Î¸ÎµÏÎ®)
                this.radius = 30;
                this.color = color;
                this.isBot = isBot;
                this.selected = false;
                this.vx = 0;  // Î¤Î±Ï‡ÏÏ„Î·Ï„Î±
                this.vy = 0;
                this.friction = 0.95;
                this.moving = false;
                this.collisionCooldown = {};  // Cooldown Î±Î½Î¬ Ï€Î±Î¯ÎºÏ„Î· Î³Î¹Î± Î½Î± Î¼Î·Î½ ÎºÎ¿Î»Î»Î¬Î½Îµ
                this.ballCollisionTime = 0;  // Cooldown Î³Î¹Î± Ï„Î·Î½ Î¼Ï€Î¬Î»Î±
                this.isRelocating = false;  // Flag Î³Î¹Î± animation Î¼ÎµÏ„Î±ÎºÎ¯Î½Î·ÏƒÎ·Ï‚
                this.relocateTarget = null;  // Î ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î¼ÎµÏ„Î±ÎºÎ¯Î½Î·ÏƒÎ·Ï‚
                this.relocateStartTime = 0;  // Î§ÏÏŒÎ½Î¿Ï‚ Î­Î½Î±ÏÎ¾Î·Ï‚ animation
                this.relocateStartPos = null;  // Î‘ÏÏ‡Î¹ÎºÎ® Î¸Î­ÏƒÎ· animation
            }

            update() {
                // Animation Î¼ÎµÏ„Î±ÎºÎ¯Î½Î·ÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï„Î­ÏÎ¼Î±
                if (this.isRelocating) {
                    const duration = 800;  // 0.8 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
                    const elapsed = Date.now() - this.relocateStartTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // Easing function - smooth in-out
                    const eased = progress < 0.5 
                        ? 2 * progress * progress 
                        : 1 - Math.pow(-2 * progress + 2, 2) / 2;
                    
                    // Interpolation
                    this.x = this.relocateStartPos.x + (this.relocateTarget.x - this.relocateStartPos.x) * eased;
                    this.y = this.relocateStartPos.y + (this.relocateTarget.y - this.relocateStartPos.y) * eased;
                    
                    // Î¤Î­Î»Î¿Ï‚ animation
                    if (progress >= 1) {
                        this.x = this.relocateTarget.x;
                        this.y = this.relocateTarget.y;
                        this.isRelocating = false;
                        this.relocateTarget = null;
                    }
                    
                    return;  // Î”ÎµÎ½ ÎºÎ¬Î½Î¿Ï…Î¼Îµ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ® ÎºÎ¯Î½Î·ÏƒÎ· ÏŒÏƒÎ¿ relocate
                }
                
                if (this.moving) {
                    this.x += this.vx;
                    this.y += this.vy;
                    
                    // Easing function Î³Î¹Î± Ï€Î±Î¯ÎºÏ„ÎµÏ‚ - Smooth exponential decay
                    const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                    
                    if (speed > 0.5) {
                        // Exponential decay Î³Î¹Î± Ï€Î¹Î¿ Ï†Ï…ÏƒÎ¹ÎºÎ® ÎºÎ¯Î½Î·ÏƒÎ·
                        const decayFactor = Math.pow(this.friction, 1.15);
                        this.vx *= decayFactor;
                        this.vy *= decayFactor;
                    } else {
                        // Î Î»Î®ÏÎ·Ï‚ ÏƒÏ„Î¬ÏƒÎ·
                        this.vx = 0;
                        this.vy = 0;
                        this.moving = false;
                    }

                    // Î£ÏÎ½Î¿ÏÎ± Î³Î·Ï€Î­Î´Î¿Ï… - ÎÎ­Î± ÏŒÏÎ¹Î± (20% Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿ Ï€Î»Î¬Ï„Î¿Ï‚)
                    const sideMargin = 240;  // Î‘Ï…Î¾Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ 80 (Ï€Î»ÎµÏ…ÏÎ¹ÎºÎ¬)
                    const topMargin = 180;
                    const bottomMargin = 80;  // ÎšÎ¬Ï„Ï‰ Ï€Î±ÏÎ±Î¼Î­Î½ÎµÎ¹ Ï„Î¿ Î¯Î´Î¹Î¿
                    
                    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î¿ÏÎ¯Ï‰Î½ - Î‘Î›Î›Î‘ ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î¼Îµ ÎµÎ¯ÏƒÎ¿Î´Î¿ ÏƒÏ„Î± Ï„Î­ÏÎ¼Î±Ï„Î±
                    const centerY = (topMargin + (canvas.height - bottomMargin)) / 2;
                    const goalHeight = 180;
                    const goalTop = centerY - (goalHeight / 2);
                    const goalBottom = centerY + (goalHeight / 2);
                    
                    // Î‘ÏÎ¹ÏƒÏ„ÎµÏÏŒ ÏŒÏÎ¹Î¿ - ÎµÎºÏ„ÏŒÏ‚ Î±Î½ ÎµÎ¯Î½Î±Î¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î±
                    if (this.x - this.radius < sideMargin) {
                        if (this.y < goalTop || this.y > goalBottom) {
                            // Î•ÎºÏ„ÏŒÏ‚ Ï„Î­ÏÎ¼Î±Ï„Î¿Ï‚ - bounce
                            this.x = sideMargin + this.radius;
                            this.vx *= -0.5;
                        } else {
                            // ÎœÎ­ÏƒÎ± ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î± - ÏŒÏÎ¹Î¿ Ï€Î¯ÏƒÏ‰ Î³ÏÎ±Î¼Î¼Î®Ï‚
                            const goalDepth = 60;
                            const backLine = sideMargin - goalDepth;
                            if (this.x - this.radius < backLine) {
                                this.x = backLine + this.radius;
                                this.vx = 0;  // Î£Î¤Î‘Î£Î—
                                this.vy *= 0.7;
                            }
                            // ÎŒÏÎ¹Î± Ï€Î¬Î½Ï‰-ÎºÎ¬Ï„Ï‰ ÎœÎ•Î£Î‘ ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î± (Î´Î¿ÎºÎ¬ÏÎ¹Î±)
                            if (this.y - this.radius < goalTop) {
                                this.y = goalTop + this.radius;
                                this.vy = 0;
                            }
                            if (this.y + this.radius > goalBottom) {
                                this.y = goalBottom - this.radius;
                                this.vy = 0;
                            }
                        }
                    }
                    
                    // Î”ÎµÎ¾Î¯ ÏŒÏÎ¹Î¿ - ÎµÎºÏ„ÏŒÏ‚ Î±Î½ ÎµÎ¯Î½Î±Î¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î±
                    if (this.x + this.radius > canvas.width - sideMargin) {
                        if (this.y < goalTop || this.y > goalBottom) {
                            // Î•ÎºÏ„ÏŒÏ‚ Ï„Î­ÏÎ¼Î±Ï„Î¿Ï‚ - bounce
                            this.x = canvas.width - sideMargin - this.radius;
                            this.vx *= -0.5;
                        } else {
                            // ÎœÎ­ÏƒÎ± ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î± - ÏŒÏÎ¹Î¿ Ï€Î¯ÏƒÏ‰ Î³ÏÎ±Î¼Î¼Î®Ï‚
                            const goalDepth = 60;
                            const backLine = canvas.width - sideMargin + goalDepth;
                            if (this.x + this.radius > backLine) {
                                this.x = backLine - this.radius;
                                this.vx = 0;  // Î£Î¤Î‘Î£Î—
                                this.vy *= 0.7;
                            }
                            // ÎŒÏÎ¹Î± Ï€Î¬Î½Ï‰-ÎºÎ¬Ï„Ï‰ ÎœÎ•Î£Î‘ ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î± (Î´Î¿ÎºÎ¬ÏÎ¹Î±)
                            if (this.y - this.radius < goalTop) {
                                this.y = goalTop + this.radius;
                                this.vy = 0;
                            }
                            if (this.y + this.radius > goalBottom) {
                                this.y = goalBottom - this.radius;
                                this.vy = 0;
                            }
                        }
                    }
                    
                    // Î Î¬Î½Ï‰-ÎºÎ¬Ï„Ï‰ ÏŒÏÎ¹Î± (ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¬)
                    if (this.y - this.radius < topMargin) {
                        this.y = topMargin + this.radius;
                        this.vy *= -0.5;
                    }
                    if (this.y + this.radius > canvas.height - bottomMargin) {
                        this.y = canvas.height - bottomMargin - this.radius;
                        this.vy *= -0.5;
                    }
                }
            }

            checkPlayerCollision(otherPlayer) {
                // Collision Î¼ÎµÏ„Î±Î¾Ï Ï€Î±Î¹ÎºÏ„ÏÎ½
                const dx = otherPlayer.x - this.x;
                const dy = otherPlayer.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const minDist = this.radius + otherPlayer.radius;

                if (distance < minDist && distance > 0) {
                    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ cooldown - Î±Î½ Î¼ÏŒÎ»Î¹Ï‚ Ï‡Ï„ÏÏ€Î·ÏƒÎ±Î½, Î¼Î·Î½ Ï„Î¿ Î¾Î±Î½Î±ÎºÎ¬Î½ÎµÎ¹Ï‚ Î±Î¼Î­ÏƒÏ‰Ï‚
                    const otherId = otherPlayer.x + '_' + otherPlayer.y;  // Unique ID
                    if (this.collisionCooldown[otherId] && Date.now() - this.collisionCooldown[otherId] < 100) {
                        return;  // Î ÎµÏÎ¯Î¼ÎµÎ½Îµ Î»Î¯Î³Î¿ Ï€ÏÎ¹Î½ Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· collision
                    }
                    this.collisionCooldown[otherId] = Date.now();
                    
                    // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î³Ï‰Î½Î¯Î±Ï‚ ÏƒÏÎ³ÎºÏÎ¿Ï…ÏƒÎ·Ï‚
                    const angle = Math.atan2(dy, dx);
                    const overlap = minDist - distance;
                    
                    // Î‘ÎœÎ•Î£ÎŸÎ£ ÎºÎ±Î¹ Î Î›Î—Î¡Î—Î£ Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒÏ‚ - Î¼Îµ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·
                    const separation = overlap + 2;  // +2 Î³Î¹Î± Î½Î± ÏƒÎ¹Î³Î¿Ï…ÏÎµÏ…Ï„Î¿ÏÎ¼Îµ ÏŒÏ„Î¹ Î´ÎµÎ½ ÎµÏ€Î¹ÎºÎ±Î»ÏÏ€Ï„Î¿Î½Ï„Î±Î¹
                    const pushX = Math.cos(angle) * separation / 2;
                    const pushY = Math.sin(angle) * separation / 2;
                    
                    this.x -= pushX;
                    this.y -= pushY;
                    otherPlayer.x += pushX;
                    otherPlayer.y += pushY;
                    
                    // ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±Ï‚ (Î¿ÏÎ¼Î®Ï‚) ÏƒÎ±Î½ Î¼Ï€Î¹Î»Î¹Î¬ÏÎ´Î¿
                    // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ®Ï‚ Ï„Î±Ï‡ÏÏ„Î·Ï„Î±Ï‚
                    const relVx = this.vx - otherPlayer.vx;
                    const relVy = this.vy - otherPlayer.vy;
                    
                    // Î ÏÎ¿Î²Î¿Î»Î® Ï„Î·Ï‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ®Ï‚ Ï„Î±Ï‡ÏÏ„Î·Ï„Î±Ï‚ ÏƒÏ„Î· Î³ÏÎ±Î¼Î¼Î® ÏƒÏÎ³ÎºÏÎ¿Ï…ÏƒÎ·Ï‚
                    const relVelocityDotNormal = relVx * Math.cos(angle) + relVy * Math.sin(angle);
                    
                    // Î‘Î½ Î±Ï€Î¿Î¼Î±ÎºÏÏÎ½Î¿Î½Ï„Î±Î¹ Î®Î´Î·, Î¼Î·Î½ ÎºÎ¬Î½ÎµÎ¹Ï‚ Ï„Î¯Ï€Î¿Ï„Î± Î¼Îµ Ï„Î·Î½ Ï„Î±Ï‡ÏÏ„Î·Ï„Î±
                    if (relVelocityDotNormal > 0) return;
                    
                    // Î£Ï…Î½Ï„ÎµÎ»ÎµÏƒÏ„Î®Ï‚ ÎµÎ»Î±ÏƒÏ„Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ (0.85 = Î»Î¯Î³Î· Î±Ï€ÏÎ»ÎµÎ¹Î± ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±Ï‚, Ï€Î¹Î¿ ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÏŒ)
                    const restitution = 0.85;
                    
                    // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ impulse (ÏÎ¸Î·ÏƒÎ·Ï‚)
                    const impulse = -(1 + restitution) * relVelocityDotNormal / 2;
                    
                    // Î•Ï†Î±ÏÎ¼Î¿Î³Î® impulse
                    const impulseX = impulse * Math.cos(angle);
                    const impulseY = impulse * Math.sin(angle);
                    
                    this.vx -= impulseX;
                    this.vy -= impulseY;
                    otherPlayer.vx += impulseX;
                    otherPlayer.vy += impulseY;
                    
                    // Î‘Î½ ÎºÎ¬Ï€Î¿Î¹Î¿Ï‚ Ï€Î±Î¯ÎºÏ„Î·Ï‚ Î´ÎµÎ½ ÎºÎ¹Î½Î¿ÏÎ½Ï„Î±Î½, Ï„ÏÏÎ± ÎºÎ¹Î½ÎµÎ¯Ï„Î±Î¹
                    if (!this.moving && (Math.abs(this.vx) > 0.5 || Math.abs(this.vy) > 0.5)) {
                        this.moving = true;
                    }
                    if (!otherPlayer.moving && (Math.abs(otherPlayer.vx) > 0.5 || Math.abs(otherPlayer.vy) > 0.5)) {
                        otherPlayer.moving = true;
                    }
                }
            }

            draw() {
                // Î”Î±ÎºÏ„ÏÎ»Î¹Î¿Ï‚ Î±Î½ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿Ï‚
                if (this.selected) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius + 8, 0, Math.PI * 2);
                    ctx.strokeStyle = '#FFD700';  // Î§ÏÏ…ÏƒÏŒ Î³Î¹Î± highlight
                    ctx.lineWidth = 5;
                    ctx.stroke();
                }

                // Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎ· ÎµÎ¹ÎºÏŒÎ½Î±Ï‚ duck - Î‘ÎÎ¤Î™Î£Î¤Î¡ÎŸÎ¦Î‘!
                // ÎšÏŒÎºÎºÎ¹Î½Î¿Î¹ Ï€Î±Î¯ÎºÏ„ÎµÏ‚ (YOU) â†’ ÎœÏ€Î»Îµ Ï€Î¬Ï€Î¹Î±
                // ÎœÏ€Î»Îµ Ï€Î±Î¯ÎºÏ„ÎµÏ‚ (BOT) â†’ ÎšÏŒÎºÎºÎ¹Î½Î± Ï€Î¬Ï€Î¹Î±
                const image = this.isBot ? images.duckRed : images.duckBlue;
                const size = this.radius * 2;  // Î”Î¹Î¬Î¼ÎµÏ„ÏÎ¿Ï‚
                
                // Fallback: Î‘Î½ Î· ÎµÎ¹ÎºÏŒÎ½Î± Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Ï†Î¿ÏÏ„ÏÏƒÎµÎ¹, ÏƒÏ‡ÎµÎ´Î¯Î±ÏƒÎµ Ï‡ÏÏ‰Î¼Î±Ï„Î¹ÏƒÏ„ÏŒ ÎºÏÎºÎ»Î¿
                if (image.complete && image.naturalWidth > 0) {
                    ctx.drawImage(
                        image,
                        this.x - this.radius,  // ÎšÎ­Î½Ï„ÏÎ¿ - Î±ÎºÏ„Î¯Î½Î±
                        this.y - this.radius,
                        size,
                        size
                    );
                } else {
                    // Fallback: Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎµ Ï‡ÏÏ‰Î¼Î±Ï„Î¹ÏƒÏ„ÏŒ ÎºÏÎºÎ»Î¿
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = this.isBot ? '#ff3420' : '#2745e1';
                    ctx.fill();
                    ctx.strokeStyle = COLORS.white;
                    ctx.lineWidth = 3;
                    ctx.stroke();
                }
            }

            checkCollision(ball) {
                const dx = ball.x - this.x;
                const dy = ball.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const minDistance = this.radius + ball.radius;

                if (distance < minDistance && distance > 0) {
                    // Cooldown Î³Î¹Î± Î½Î± Î¼Î·Î½ Ï‡Ï„Ï…Ï€Î¬ÎµÎ¹ ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï„Î·Î½ Î¯Î´Î¹Î± Î¼Ï€Î¬Î»Î±
                    if (Date.now() - this.ballCollisionTime < 30) {  // ÎœÎµÎ¹ÏÎ¸Î·ÎºÎµ Î±Ï€ÏŒ 50 ÏƒÎµ 30
                        return;  // Î ÎµÏÎ¯Î¼ÎµÎ½Îµ 30ms Ï€ÏÎ¹Î½ Ï„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Ï‡Ï„ÏÏ€Î·Î¼Î±
                    }
                    this.ballCollisionTime = Date.now();
                    
                    const angle = Math.atan2(dy, dx);
                    const overlap = minDistance - distance;
                    
                    // Î Î¡Î©Î¤Î‘ Ï‡Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï„Î· Î¼Ï€Î¬Î»Î± Î±Ï€ÏŒ Ï„Î¿Î½ Ï€Î±Î¯ÎºÏ„Î· Î¼Îµ Î±ÎºÏŒÎ¼Î± Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·
                    const separationMultiplier = 1.2;  // Î‘Ï…Î¾Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ 1.1 ÏƒÎµ 1.2
                    ball.x += Math.cos(angle) * (overlap * separationMultiplier + 3);  // +3 pixels extra
                    ball.y += Math.sin(angle) * (overlap * separationMultiplier + 3);
                    
                    // ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ Î¿ÏÎ¼Î®Ï‚ Î±Ï€ÏŒ Ï€Î±Î¯ÎºÏ„Î· ÏƒÎµ Î¼Ï€Î¬Î»Î± (impulse-based physics)
                    const relativeVx = this.vx - ball.vx;
                    const relativeVy = this.vy - ball.vy;
                    
                    // Î ÏÎ¿Î²Î¿Î»Î® Ï„Î·Ï‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ®Ï‚ Ï„Î±Ï‡ÏÏ„Î·Ï„Î±Ï‚ ÏƒÏ„Î· Î³ÏÎ±Î¼Î¼Î® ÏƒÏÎ³ÎºÏÎ¿Ï…ÏƒÎ·Ï‚
                    const relVelocityDotNormal = relativeVx * Math.cos(angle) + relativeVy * Math.sin(angle);
                    
                    // Î‘Î½ Î±Ï€Î¿Î¼Î±ÎºÏÏÎ½Î¿Î½Ï„Î±Î¹ Î®Î´Î·, Î¼Î·Î½ ÎºÎ¬Î½ÎµÎ¹Ï‚ Ï„Î¯Ï€Î¿Ï„Î±
                    if (relVelocityDotNormal < 0) return;
                    
                    // Î£Ï…Î½Ï„ÎµÎ»ÎµÏƒÏ„Î®Ï‚ ÎµÎ»Î±ÏƒÏ„Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ ÎºÎ±Î¹ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬ Î¼Î¬Î¶Î±Ï‚
                    const restitution = 0.9;  // Î›Î¯Î³Î· Î±Ï€ÏÎ»ÎµÎ¹Î± ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±Ï‚
                    const massRatio = 0.8;  // ÎŸ Ï€Î±Î¯ÎºÏ„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ Î²Î±ÏÏÏ„ÎµÏÎ¿Ï‚, Î¬ÏÎ± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ· Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬
                    
                    // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ impulse
                    const impulse = (1 + restitution) * relVelocityDotNormal * massRatio;
                    
                    // Î•Ï†Î±ÏÎ¼Î¿Î³Î® impulse ÏƒÏ„Î· Î¼Ï€Î¬Î»Î±
                    ball.vx += Math.cos(angle) * impulse;
                    ball.vy += Math.sin(angle) * impulse;
                }
            }

            isClicked(x, y) {
                const dx = x - this.x;
                const dy = y - this.y;
                return Math.sqrt(dx * dx + dy * dy) <= this.radius;
            }

            shoot(dragX, dragY) {
                // Î‘Î½Ï„Î¯ÏƒÏ„ÏÎ¿Ï†Î· ÎºÎ±Ï„ÎµÏÎ¸Ï…Î½ÏƒÎ· (slingshot)
                const maxDragDistance = 200; // ÎœÎ­Î³Î¹ÏƒÏ„Î· Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ· Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï„ÏÎ±Î²Î®Î¾ÎµÎ¹Ï‚
                const dragDistance = Math.sqrt(dragX * dragX + dragY * dragY);
                
                console.log('Shooting with drag distance:', dragDistance);
                
                // Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï„Î·Ï‚ Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·Ï‚
                let limitedDragX = dragX;
                let limitedDragY = dragY;
                
                if (dragDistance > maxDragDistance) {
                    const ratio = maxDragDistance / dragDistance;
                    limitedDragX = dragX * ratio;
                    limitedDragY = dragY * ratio;
                }
                
                // ÎœÎµÎ¹Ï‰Î¼Î­Î½Î· Î´ÏÎ½Î±Î¼Î· Î³Î¹Î± ÎºÎ±Î»ÏÏ„ÎµÏÎ¿ control - ÎµÎ¹Î´Î¹ÎºÎ¬ Î³Î¹Î± touch
                const power = Math.min(dragDistance, maxDragDistance) / maxDragDistance; // 0 Î­Ï‰Ï‚ 1
                const maxSpeed = 25; // ÎœÎµÎ¹Ï‰Î¼Î­Î½Î¿ Î±Ï€ÏŒ 38 Î³Î¹Î± ÎºÎ±Î»ÏÏ„ÎµÏÎ¿ control ÏƒÏ„Î¿ ÎºÎ¹Î½Î·Ï„ÏŒ
                
                this.vx = -limitedDragX * (maxSpeed / maxDragDistance);
                this.vy = -limitedDragY * (maxSpeed / maxDragDistance);
                
                console.log('Velocities:', this.vx, this.vy);
                
                this.moving = true;
            }
        }

        // Î Î±Î¹Ï‡Î½Î¯Î´Î¹
        class Game {
            constructor() {
                this.ball = new Ball();
                this.playerScore = 0;
                this.botScore = 0;
                this.currentTurn = 'player'; // 'player' Î® 'bot'
                this.turnComplete = true;
                this.goalMessage = null;  // ÎœÎ®Î½Ï…Î¼Î± Î³ÎºÎ¿Î»
                this.goalMessageTime = 0;  // Î§ÏÏŒÎ½Î¿Ï‚ ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·Ï‚ Î¼Î·Î½ÏÎ¼Î±Ï„Î¿Ï‚
                
                // Î”Î¿ÎºÎ¬ÏÎ¹Î± Ï„ÎµÏÎ¼Î¬Ï„Ï‰Î½
                const margin = 240;
                const topMargin = 180;
                const centerY = (topMargin + (canvas.height - 80)) / 2;
                
                this.goalPosts = [
                    // Î‘ÏÎ¹ÏƒÏ„ÎµÏÏŒ Ï„Î­ÏÎ¼Î±
                    { x: margin, y: centerY - 90, radius: 8 },  // Î Î¬Î½Ï‰
                    { x: margin, y: centerY + 90, radius: 8 },  // ÎšÎ¬Ï„Ï‰
                    // Î”ÎµÎ¾Î¯ Ï„Î­ÏÎ¼Î±
                    { x: canvas.width - margin, y: centerY - 90, radius: 8 },  // Î Î¬Î½Ï‰
                    { x: canvas.width - margin, y: centerY + 90, radius: 8 }   // ÎšÎ¬Ï„Ï‰
                ];
                
                // Î‘ÏÏ‡Î¹ÎºÎ­Ï‚ Î¸Î­ÏƒÎµÎ¹Ï‚ Ï€Î±Î¹ÎºÏ„ÏÎ½ - ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î¿ Î³Î®Ï€ÎµÎ´Î¿
                
                this.initialPositions = {
                    player: [
                        { x: margin + 150, y: centerY - 180 },
                        { x: margin + 150, y: centerY + 180 },
                        { x: margin + 280, y: centerY - 100 },
                        { x: margin + 100, y: centerY },
                        { x: margin + 280, y: centerY + 100 }
                    ],
                    bot: [
                        { x: canvas.width - margin - 150, y: centerY - 180 },
                        { x: canvas.width - margin - 150, y: centerY + 180 },
                        { x: canvas.width - margin - 280, y: centerY - 100 },
                        { x: canvas.width - margin - 100, y: centerY },
                        { x: canvas.width - margin - 280, y: centerY + 100 }
                    ]
                };
                
                // Î Î±Î¯ÎºÏ„ÎµÏ‚ (ÎºÏŒÎºÎºÎ¹Î½Î¿Î¹ - ÎºÎ¬Ï„Ï‰)
                this.playerTeam = this.initialPositions.player.map(pos => 
                    new Player(pos.x, pos.y, COLORS.red)
                );

                // Bot (Î¼Ï€Î»Îµ - Ï€Î¬Î½Ï‰)
                this.botTeam = this.initialPositions.bot.map(pos => 
                    new Player(pos.x, pos.y, COLORS.blue, true)
                );

                this.selectedPlayer = null;
                this.dragStart = null;
                this.currentDrag = null;
                this.setupEvents();
            }

            setupEvents() {
                canvas.addEventListener('mousedown', (e) => this.onMouseDown(e));
                canvas.addEventListener('mousemove', (e) => this.onMouseMove(e));
                canvas.addEventListener('mouseup', (e) => this.onMouseUp(e));
                canvas.addEventListener('touchstart', (e) => this.onTouchStart(e));
                canvas.addEventListener('touchmove', (e) => this.onTouchMove(e));
                canvas.addEventListener('touchend', (e) => this.onTouchEnd(e));
            }

            getMousePos(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                return {
                    x: (e.clientX - rect.left) * scaleX,
                    y: (e.clientY - rect.top) * scaleY
                };
            }

            onMouseDown(e) {
                // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ ÎµÎ¯Î½Î±Î¹ ÏƒÎµÎ¹ÏÎ¬ Ï„Î¿Ï… Ï€Î±Î¯ÎºÏ„Î·
                if (this.currentTurn !== 'player') return;
                if (!this.turnComplete) return;

                const pos = this.getMousePos(e);
                console.log('Mouse down at:', pos.x, pos.y);

                for (let player of this.playerTeam) {
                    if (player.isClicked(pos.x, pos.y)) {
                        this.selectedPlayer = player;
                        player.selected = true;
                        this.dragStart = { x: player.x, y: player.y };
                        console.log('Selected player at:', player.x, player.y);
                        break;
                    }
                }
            }

            onMouseMove(e) {
                if (this.selectedPlayer && this.dragStart) {
                    const pos = this.getMousePos(e);
                    this.currentDrag = pos;
                }
            }

            onMouseUp(e) {
                if (this.selectedPlayer && this.dragStart) {
                    // Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ valid position (Ï€Ï‡ touch Ï€Î¿Ï… Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ clientX/Y),
                    // Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î¿ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿ currentDrag position
                    let pos;
                    if (e && e.clientX !== undefined && e.clientY !== undefined) {
                        pos = this.getMousePos(e);
                    } else if (this.currentDrag) {
                        pos = this.currentDrag;
                    } else {
                        pos = this.dragStart;
                    }
                    
                    const dragX = pos.x - this.dragStart.x;
                    const dragY = pos.y - this.dragStart.y;
                    
                    console.log('Drag values:', dragX, dragY, 'Distance:', Math.sqrt(dragX*dragX + dragY*dragY));
                    
                    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± Ï€Î¿Î»Ï Î¼Î¹ÎºÏÏŒ drag (tap Ï‡Ï‰ÏÎ¯Ï‚ drag)
                    const dragDistance = Math.sqrt(dragX * dragX + dragY * dragY);
                    if (dragDistance < 5) {
                        // Î Î¿Î»Ï Î¼Î¹ÎºÏÏŒ drag - Î±ÎºÏÏÏ‰ÏƒÎ·
                        console.log('Drag too small, canceling');
                        this.selectedPlayer.selected = false;
                        this.selectedPlayer = null;
                        this.dragStart = null;
                        this.currentDrag = null;
                        return;
                    }
                    
                    // Î•ÎºÏ„ÏŒÎ¾ÎµÏ…ÏƒÎ· Î¼Îµ slingshot mechanics
                    this.selectedPlayer.shoot(dragX, dragY);
                    
                    // ÎÎµÎºÎ¹Î½Î¬ÎµÎ¹ Î· ÏƒÎµÎ¹ÏÎ¬
                    this.turnComplete = false;
                    
                    this.selectedPlayer.selected = false;
                    this.selectedPlayer = null;
                    this.dragStart = null;
                    this.currentDrag = null;
                }
            }

            onTouchStart(e) {
                e.preventDefault();
                e.stopPropagation();
                const touch = e.touches[0];
                const mouseEvent = {
                    clientX: touch.clientX,
                    clientY: touch.clientY,
                    preventDefault: () => {}
                };
                this.onMouseDown(mouseEvent);
            }

            onTouchMove(e) {
                e.preventDefault();
                e.stopPropagation();
                const touch = e.touches[0];
                const mouseEvent = {
                    clientX: touch.clientX,
                    clientY: touch.clientY,
                    preventDefault: () => {}
                };
                this.onMouseMove(mouseEvent);
            }

            onTouchEnd(e) {
                e.preventDefault();
                e.stopPropagation();
                // Î“Î¹Î± touchend, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î¿ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿ changedTouches
                if (e.changedTouches && e.changedTouches.length > 0) {
                    const touch = e.changedTouches[0];
                    const mouseEvent = {
                        clientX: touch.clientX,
                        clientY: touch.clientY,
                        preventDefault: () => {}
                    };
                    this.onMouseUp(mouseEvent);
                } else {
                    this.onMouseUp({});
                }
            }

            drawField() {
                // Î¦ÏŒÎ½Ï„Î¿
                ctx.fillStyle = COLORS.orange;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Î¤Î±Î¼Ï€Î­Î»Î± ÏƒÎºÎ¿Ï ÏƒÏ„Î¿ Ï†ÏŒÎ½Ï„Î¿ (Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î¿ Î³Î®Ï€ÎµÎ´Î¿)
                this.drawScoreboard();

                // Î“Î®Ï€ÎµÎ´Î¿ - 20% Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿ Ï€Î»Î¬Ï„Î¿Ï‚
                const sideMargin = 240;  // Î‘Ï…Î¾Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ 80 (80 + 20% Ï„Î¿Ï… Ï€Î»Î¬Ï„Î¿Ï…Ï‚)
                const topMargin = 180;
                const bottomMargin = 80;
                
                // Î£Ï„ÏÎ¿Î³Î³Ï…Î»ÎµÎ¼Î­Î½Î¿ Î³Î®Ï€ÎµÎ´Î¿ Î¼Îµ Î±ÎºÏ„Î¯Î½Î± ÎºÎ±Î¼Ï€ÏÎ»Î·Ï‚ ÏƒÏ„Î¹Ï‚ Î³Ï‰Î½Î¯ÎµÏ‚
                const fieldCornerRadius = 30;
                const borderWidth = 45;  // Î Î»Î¬Ï„Î¿Ï‚ Ï„Î¿Ï… Î³ÎºÏÎ¹ Ï€ÎµÏÎ¹Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ (Î±Ï…Î¾Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ 25)
                
                // Î“ÎºÏÎ¹ Ï€ÎµÏÎ¯Î³ÏÎ±Î¼Î¼Î± (ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÏŒ Ï€Î»Î±Î¯ÏƒÎ¹Î¿)
                ctx.fillStyle = '#8a8a8a';  // Î“ÎºÏÎ¹ Ï‡ÏÏÎ¼Î± ÏŒÏ€Ï‰Ï‚ ÏƒÏ„Î·Î½ ÎµÎ¹ÎºÏŒÎ½Î±
                ctx.beginPath();
                ctx.roundRect(
                    sideMargin - borderWidth, 
                    topMargin - borderWidth, 
                    canvas.width - (sideMargin * 2) + (borderWidth * 2), 
                    canvas.height - topMargin - bottomMargin + (borderWidth * 2), 
                    fieldCornerRadius + 5
                );
                ctx.fill();
                
                // Î ÏÎ¬ÏƒÎ¹Î½Î¿ Î³Î®Ï€ÎµÎ´Î¿
                ctx.fillStyle = COLORS.green;
                ctx.beginPath();
                ctx.roundRect(sideMargin, topMargin, canvas.width - (sideMargin * 2), canvas.height - topMargin - bottomMargin, fieldCornerRadius);
                ctx.fill();
                
                // Î›ÎµÏ…ÎºÏŒ outline Ï„Î¿Ï… Î³Î·Ï€Î­Î´Î¿Ï…
                ctx.strokeStyle = COLORS.white;
                ctx.lineWidth = 6;  // Î‘Ï…Î¾Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ 3 ÏƒÎµ 6
                ctx.beginPath();
                ctx.roundRect(sideMargin, topMargin, canvas.width - (sideMargin * 2), canvas.height - topMargin - bottomMargin, fieldCornerRadius);
                ctx.stroke();

                // ÎœÎµÏƒÎ±Î¯Î± Î³ÏÎ±Î¼Î¼Î® - ÎšÎ¬Î¸ÎµÏ„Î·
                ctx.beginPath();
                ctx.moveTo(canvas.width / 2, topMargin);
                ctx.lineTo(canvas.width / 2, canvas.height - bottomMargin);
                ctx.strokeStyle = COLORS.white;
                ctx.lineWidth = 6;  // Î‘Ï…Î¾Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ 3 ÏƒÎµ 6
                ctx.stroke();

                // ÎšÎµÎ½Ï„ÏÎ¹ÎºÏŒÏ‚ ÎºÏÎºÎ»Î¿Ï‚ - 50% Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿Ï‚ (Î±Ï€ÏŒ 70 ÏƒÎµ 105)
                ctx.beginPath();
                const centerX = canvas.width / 2;
                const centerY = (topMargin + (canvas.height - bottomMargin)) / 2;
                ctx.arc(centerX, centerY, 105, 0, Math.PI * 2);  // Î‘Ï…Î¾Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ 70 ÏƒÎµ 105
                ctx.strokeStyle = COLORS.white;
                ctx.lineWidth = 6;  // Î‘Ï…Î¾Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ 3 ÏƒÎµ 6
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(centerX, centerY, 8, 0, Math.PI * 2);
                ctx.fillStyle = COLORS.black;
                ctx.fill();

                // Î ÎµÏÎ¹Î¿Ï‡Î­Ï‚ - ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± (50% Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎµÏ‚)
                ctx.strokeStyle = COLORS.white;
                ctx.lineWidth = 6;  // Î‘Ï…Î¾Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ 3 ÏƒÎµ 6
                // Î‘ÏÎ¹ÏƒÏ„ÎµÏÎ¬
                ctx.strokeRect(sideMargin, centerY - 195, 150, 390);  // ÎœÎµÎ³Î¬Î»Î· Ï€ÎµÏÎ¹Î¿Ï‡Î® (100->150, 260->390)
                ctx.strokeRect(sideMargin, centerY - 120, 75, 240);   // ÎœÎ¹ÎºÏÎ® Ï€ÎµÏÎ¹Î¿Ï‡Î® (50->75, 160->240)
                
                // Î—Î¼Î¹ÎºÏÎºÎ»Î¹Î¿ Î±ÏÎ¹ÏƒÏ„ÎµÏÎ®Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚ - Î•ÎÎ© Ï€ÏÎ¿Ï‚ Ï„Î± Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬
                ctx.beginPath();
                ctx.arc(sideMargin + 150, centerY, 60, -Math.PI / 2, Math.PI / 2);
                ctx.stroke();
                
                // Î”ÎµÎ¾Î¹Î¬
                ctx.strokeRect(canvas.width - sideMargin - 150, centerY - 195, 150, 390);  // ÎœÎµÎ³Î¬Î»Î· Ï€ÎµÏÎ¹Î¿Ï‡Î®
                ctx.strokeRect(canvas.width - sideMargin - 75, centerY - 120, 75, 240);   // ÎœÎ¹ÎºÏÎ® Ï€ÎµÏÎ¹Î¿Ï‡Î®
                
                // Î—Î¼Î¹ÎºÏÎºÎ»Î¹Î¿ Î´ÎµÎ¾Î¹Î¬Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚ - Î•ÎÎ© Ï€ÏÎ¿Ï‚ Ï„Î± Î´ÎµÎ¾Î¹Î¬
                ctx.beginPath();
                ctx.arc(canvas.width - sideMargin - 150, centerY, 60, Math.PI / 2, Math.PI * 1.5);
                ctx.stroke();

                // Î¤ÎµÏ„Î±ÏÏ„Î·Î¼ÏŒÏÎ¹Î± ÎºÏŒÏÎ½ÎµÏ
                const cornerRadius = 40;
                ctx.lineWidth = 6;
                ctx.strokeStyle = COLORS.white;
                
                // Î Î¬Î½Ï‰ Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬
                ctx.beginPath();
                ctx.arc(sideMargin, topMargin, cornerRadius, 0, Math.PI / 2);
                ctx.stroke();
                
                // Î Î¬Î½Ï‰ Î´ÎµÎ¾Î¹Î¬
                ctx.beginPath();
                ctx.arc(canvas.width - sideMargin, topMargin, cornerRadius, Math.PI / 2, Math.PI);
                ctx.stroke();
                
                // ÎšÎ¬Ï„Ï‰ Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬
                ctx.beginPath();
                ctx.arc(sideMargin, canvas.height - bottomMargin, cornerRadius, Math.PI * 1.5, Math.PI * 2);
                ctx.stroke();
                
                // ÎšÎ¬Ï„Ï‰ Î´ÎµÎ¾Î¹Î¬
                ctx.beginPath();
                ctx.arc(canvas.width - sideMargin, canvas.height - bottomMargin, cornerRadius, Math.PI, Math.PI * 1.5);
                ctx.stroke();

                // Î¤Î­ÏÎ¼Î± Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬ (Player) - ÎšÏŒÎºÎºÎ¹Î½Î¿
                ctx.fillStyle = COLORS.lightRed;
                ctx.fillRect(sideMargin - 55, centerY - 90, 55, 180);
                ctx.strokeStyle = COLORS.white;
                ctx.lineWidth = 6;  // Î‘Ï…Î¾Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ 4 ÏƒÎµ 6
                ctx.strokeRect(sideMargin - 55, centerY - 90, 55, 180);

                // Î”Î¯Ï‡Ï„Ï… Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¿Ï Ï„Î­ÏÎ¼Î±Ï„Î¿Ï‚ (Ï€ÏÏÏ„Î±)
                this.drawGoalNet(sideMargin - 55, centerY - 90, 55, 180, 'left');

                // Î¤Î­ÏÎ¼Î± Î´ÎµÎ¾Î¹Î¬ (Bot) - ÎœÏ€Î»Îµ
                ctx.fillStyle = COLORS.cyan;
                ctx.fillRect(canvas.width - sideMargin, centerY - 90, 55, 180);
                ctx.strokeStyle = COLORS.white;
                ctx.lineWidth = 6;  // Î‘Ï…Î¾Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ 4 ÏƒÎµ 6
                ctx.strokeRect(canvas.width - sideMargin, centerY - 90, 55, 180);
                
                // Î”Î¯Ï‡Ï„Ï… Î´ÎµÎ¾Î¹Î¿Ï Ï„Î­ÏÎ¼Î±Ï„Î¿Ï‚ (Ï€ÏÏÏ„Î±)
                this.drawGoalNet(canvas.width - sideMargin, centerY - 90, 55, 180, 'right');
                
                // Î¤Î‘ Î”ÎŸÎšÎ‘Î¡Î™Î‘ Î˜Î‘ Î£Î§Î•Î”Î™Î‘Î£Î¤ÎŸÎ¥Î Î£Î¤ÎŸ draw() - ÎŸÎ§Î™ Î•Î”Î©!
            }

            drawGoalPost(x, y, radius, color) {
                // Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎ· Î´Î¿ÎºÎ±ÏÎ¹Î¿Ï (ÎºÏÎºÎ»Î¿Ï‚)
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                // Î Î¿Î»Ï Î»ÎµÏ€Ï„ÏŒ Î»ÎµÏ…ÎºÏŒ outline Î³Î¹Î± definition
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            drawGoalNet(x, y, width, height, side) {
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)';  // Î›ÎµÏ…ÎºÏŒ Î·Î¼Î¹Î´Î¹Î±Ï†Î±Î½Î­Ï‚
                ctx.lineWidth = 1.5;
                
                const gridSize = 15;  // ÎœÎ­Î³ÎµÎ¸Î¿Ï‚ ÎºÎ¬Î¸Îµ Ï„ÎµÏ„ÏÎ¬Î³Ï‰Î½Î¿Ï… ÏƒÏ„Î¿ Î´Î¯Ï‡Ï„Ï…
                
                // ÎšÎ¬Î¸ÎµÏ„ÎµÏ‚ Î³ÏÎ±Î¼Î¼Î­Ï‚
                for (let i = gridSize; i < width; i += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(x + i, y);
                    ctx.lineTo(x + i, y + height);
                    ctx.stroke();
                }
                
                // ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹ÎµÏ‚ Î³ÏÎ±Î¼Î¼Î­Ï‚
                for (let j = gridSize; j < height; j += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(x, y + j);
                    ctx.lineTo(x + width, y + j);
                    ctx.stroke();
                }
                
                // Î”Î¹Î±Î³ÏÎ½Î¹ÎµÏ‚ Î³Î¹Î± Ï€Î¹Î¿ ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÏŒ Î´Î¯Ï‡Ï„Ï… (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';  // Î‘ÎºÏŒÎ¼Î± Ï€Î¹Î¿ Î·Î¼Î¹Î´Î¹Î±Ï†Î±Î½Î­Ï‚
                ctx.lineWidth = 1;
                
                for (let i = 0; i < width; i += gridSize) {
                    for (let j = 0; j < height; j += gridSize) {
                        ctx.beginPath();
                        ctx.moveTo(x + i, y + j);
                        ctx.lineTo(x + i + gridSize, y + j + gridSize);
                        ctx.stroke();
                    }
                }
            }

            drawScoreboard() {
                // Î£ÏÎ³Ï‡ÏÎ¿Î½Î¿ minimalist scoreboard - Î Î¬Î½Ï‰ ÎºÎ­Î½Ï„ÏÎ¿
                const scoreboardWidth = 400;
                const scoreboardHeight = 100;
                const scoreboardX = canvas.width / 2 - scoreboardWidth / 2;
                const scoreboardY = 20;
                
                // ÎšÏÏÎ¹Î¿ background Î¼Îµ Î·Î¼Î¹Î´Î¹Î¬Ï†Î±Î½Î¿ Î¼Î±ÏÏÎ¿
                ctx.fillStyle = 'rgba(0, 0, 0, 0.75)';
                ctx.roundRect(scoreboardX, scoreboardY, scoreboardWidth, scoreboardHeight, 15);
                ctx.fill();
                
                // Î›ÎµÏ…ÎºÏŒ outline
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 2;
                ctx.roundRect(scoreboardX, scoreboardY, scoreboardWidth, scoreboardHeight, 15);
                ctx.stroke();
                
                // Î‘ÏÎ¹ÏƒÏ„ÎµÏÏŒ Ï„Î¼Î®Î¼Î± - ÎœÏ€Î»Îµ Î¿Î¼Î¬Î´Î± (Player)
                const leftSectionX = scoreboardX + 20;
                const leftSectionY = scoreboardY + 25;
                
                // Î£ÎºÎ¿Ï Î¼Ï€Î»Îµ Î¿Î¼Î¬Î´Î±Ï‚ (Player - Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬)
                ctx.font = 'bold 48px Arial';
                ctx.fillStyle = '#2745e1';
                ctx.textAlign = 'center';
                ctx.fillText(this.playerScore, leftSectionX + 50, leftSectionY + 40);
                
                // Divider ÏƒÏ„Î· Î¼Î­ÏƒÎ·
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.font = 'bold 40px Arial';
                ctx.fillText(':', canvas.width / 2, leftSectionY + 38);
                
                // Î”ÎµÎ¾Î¯ Ï„Î¼Î®Î¼Î± - ÎšÏŒÎºÎºÎ¹Î½Î· Î¿Î¼Î¬Î´Î± (Bot)
                const rightSectionX = scoreboardX + scoreboardWidth - 120;
                
                // Î£ÎºÎ¿Ï ÎºÏŒÎºÎºÎ¹Î½Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚ (Bot - Î´ÎµÎ¾Î¹Î¬)
                ctx.font = 'bold 48px Arial';
                ctx.fillStyle = '#ff3420';
                ctx.textAlign = 'center';
                ctx.fillText(this.botScore, rightSectionX + 50, leftSectionY + 40);
                
                // Reset text align
                ctx.textAlign = 'left';
            }

            resetPositions() {
                // Reset Ï€Î±Î¹ÎºÏ„ÏÎ½ ÏƒÏ„Î¹Ï‚ Î±ÏÏ‡Î¹ÎºÎ­Ï‚ Î¸Î­ÏƒÎµÎ¹Ï‚
                this.playerTeam.forEach((player, i) => {
                    player.x = this.initialPositions.player[i].x;
                    player.y = this.initialPositions.player[i].y;
                    player.vx = 0;
                    player.vy = 0;
                    player.moving = false;
                });
                
                this.botTeam.forEach((player, i) => {
                    player.x = this.initialPositions.bot[i].x;
                    player.y = this.initialPositions.bot[i].y;
                    player.vx = 0;
                    player.vy = 0;
                    player.moving = false;
                });
                
                // Reset Î¼Ï€Î¬Î»Î±Ï‚
                this.ball.reset();
            }

            botMove() {
                // âœ… Phase 1.1: Bot Ï€Î±Î¯Î¶ÎµÎ¹ Î¼ÏŒÎ½Î¿ ÏŒÏ„Î±Î½ ÎµÎ¯Î½Î±Î¹ Î· ÏƒÎµÎ¹ÏÎ¬ Ï„Î¿Ï…
                if (this.currentTurn !== 'bot') return;
                if (!this.turnComplete) return;

                // ÎœÎ¹ÎºÏÎ® ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ· Î³Î¹Î± Ï€Î¹Î¿ Ï†Ï…ÏƒÎ¹ÎºÎ® Î±Î¯ÏƒÎ¸Î·ÏƒÎ·
                if (!this.botThinkingTime) {
                    this.botThinkingTime = Date.now();
                }
                
                if (Date.now() - this.botThinkingTime < 1000) return; // 1 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î¿ ÏƒÎºÎ­ÏˆÎ·
                
                this.botThinkingTime = null;

                // âœ… Phase 1.2: Î ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î¸Î­ÏƒÎ·Ï‚ player goal (Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬)
                const sideMargin = 240;
                const topMargin = 180;
                const bottomMargin = 80;
                const fieldCenterY = (topMargin + (canvas.height - bottomMargin)) / 2;
                const playerGoalX = sideMargin - 27.5; // ÎšÎ­Î½Ï„ÏÎ¿ Ï„Î­ÏÎ¼Î±Ï„Î¿Ï‚
                const playerGoalY = fieldCenterY;

                // âœ… Phase 3: Smart Player Selection - Î’ÏÎµÏ‚ Ï„Î¿Î½ ÎºÎ±Î»ÏÏ„ÎµÏÎ¿ Ï€Î±Î¯ÎºÏ„Î·
                let bestPlayer = null;
                let bestScore = -Infinity;

                for (let bot of this.botTeam) {
                    const score = this.evaluatePlayerQuality(bot, this.ball, {x: playerGoalX, y: playerGoalY});
                    if (score > bestScore) {
                        bestScore = score;
                        bestPlayer = bot;
                    }
                }

                if (!bestPlayer) return;

                // âœ… Phase 4: Adaptive Strategy - ÎšÎ±Î¸ÏŒÏÎ¹ÏƒÎµ ÏƒÏ„ÏÎ±Ï„Î·Î³Î¹ÎºÎ®
                const strategy = this.determineStrategy();
                
                // âœ… Phase 2: Goal-Oriented Aiming - Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ shot Ï€ÏÎ¿Ï‚ Ï„Î­ÏÎ¼Î±
                const shotVector = this.calculateShotToGoal(
                    bestPlayer, 
                    this.ball, 
                    {x: playerGoalX, y: playerGoalY},
                    strategy
                );

                // Fallback: Î‘Î½ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÎºÎ¿ÏÎ¬ÏÎµÎ¹, Ï‡Ï„ÏÏ€Î± Î±Ï€Î»Î¬ Ï„Î·Î½ Î¼Ï€Î¬Î»Î±
                if (!shotVector || !shotVector.canShoot) {
                    const dx = this.ball.x - bestPlayer.x;
                    const dy = this.ball.y - bestPlayer.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist > 10) { // Î‘Î½ Î· Î¼Ï€Î¬Î»Î± ÎµÎ¯Î½Î±Î¹ Ï€Î¿Î»Ï ÎºÎ¿Î½Ï„Î¬, skip
                        const power = 30;
                        bestPlayer.vx = (dx / dist) * power;
                        bestPlayer.vy = (dy / dist) * power;
                        bestPlayer.moving = true;
                        this.turnComplete = false;
                    }
                    return;
                }

                // âœ… Phase 5: Human-like Imperfection - Î ÏÏŒÏƒÎ¸ÎµÏƒÎµ Î»Î¬Î¸Î¿Ï‚
                const finalShot = this.addHumanError(shotVector.vx, shotVector.vy, 0.12);
                
                bestPlayer.vx = finalShot.vx;
                bestPlayer.vy = finalShot.vy;
                bestPlayer.moving = true;
                
                // ÎÎµÎºÎ¹Î½Î¬ÎµÎ¹ Î· ÏƒÎµÎ¹ÏÎ¬
                this.turnComplete = false;
            }

            // âœ… Phase 2.2: Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ shot Ï€Î¿Ï… ÏƒÏ„Î¿Ï‡ÎµÏÎµÎ¹ Ï„Î¿ Ï„Î­ÏÎ¼Î±
            calculateShotToGoal(player, ball, goal, strategy) {
                // 2.2a: Î”Î¹Î¬Î½Ï…ÏƒÎ¼Î± player â†’ ball
                const toBallX = ball.x - player.x;
                const toBallY = ball.y - player.y;
                const distToBall = Math.sqrt(toBallX * toBallX + toBallY * toBallY);
                
                // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ ÎµÎ¯Î½Î±Î¹ Ï€Î¿Î»Ï ÎºÎ¿Î½Ï„Î¬ Î® Ï€Î¿Î»Ï Î¼Î±ÎºÏÎ¹Î¬ - Ï€Î¹Î¿ Î±Î½ÎµÎºÏ„Î¹ÎºÎ¬ ÏŒÏÎ¹Î±
                if (distToBall < 10) {
                    return {canShoot: false}; // Î Î¿Î»Ï ÎºÎ¿Î½Ï„Î¬
                }
                
                if (distToBall > 800) {
                    return {canShoot: false}; // Î Î¿Î»Ï Î¼Î±ÎºÏÎ¹Î¬
                }

                // 2.2b: Î”Î¹Î¬Î½Ï…ÏƒÎ¼Î± ball â†’ goal
                const ballToGoalX = goal.x - ball.x;
                const ballToGoalY = goal.y - ball.y;
                
                // 2.2c: Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î­Î¼Î¼ÎµÏƒÎ·Ï‚ ÎºÎ±Ï„ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚ (Ï‡Ï„ÏÏ€Î·Î¼Î± Î¼Ï€Î¬Î»Î±Ï‚ Ï€ÏÎ¿Ï‚ Ï„Î­ÏÎ¼Î±)
                // ÎšÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ±Ï„ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚ Ï€ÏÎ¿Ï‚ Î¼Ï€Î¬Î»Î±
                const dirX = toBallX / distToBall;
                const dirY = toBallY / distToBall;
                
                // Power Î²Î¬ÏƒÎµÎ¹ strategy ÎºÎ±Î¹ Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·Ï‚
                let basePower;
                if (strategy === 'aggressive') {
                    basePower = 35 + Math.random() * 15; // 35-50
                } else if (strategy === 'defensive') {
                    basePower = 20 + Math.random() * 15; // 20-35
                } else {
                    basePower = 25 + Math.random() * 15; // 25-40
                }
                
                // Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿Î³Î® power Î²Î¬ÏƒÎµÎ¹ Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·Ï‚
                if (distToBall > 400) {
                    basePower *= 1.2; // Î Î¹Î¿ Î´Ï…Î½Î±Ï„Î¬ Î³Î¹Î± Î¼Î±ÎºÏÎ¹Î½Î¬ shots
                }
                
                // 2.2d: Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÎºÎ±Ï„ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚
                return {
                    canShoot: true,
                    vx: dirX * basePower,
                    vy: dirY * basePower,
                    quality: 1 - (distToBall / 800) // Quality score 0-1
                };
            }

            // âœ… Phase 3.1: Î‘Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ· Ï€Î¿Î¹ÏŒÏ„Î·Ï„Î±Ï‚ Ï€Î±Î¯ÎºÏ„Î·
            evaluatePlayerQuality(player, ball, goal) {
                // 3.1a: Distance score (Ï€Î¹Î¿ ÎºÎ¿Î½Ï„Î¬ = ÎºÎ±Î»ÏÏ„ÎµÏÎ¿)
                const distToBall = Math.sqrt(
                    (ball.x - player.x) ** 2 + (ball.y - player.y) ** 2
                );
                
                // Î Î¹Î¿ Î±Î½ÎµÎºÏ„Î¹ÎºÏŒ distance scoring
                const distanceScore = Math.max(0, 1 - distToBall / 800);

                // 3.1b: Angle score (ÎºÎ±Î»ÏÏ„ÎµÏÎ· Î³Ï‰Î½Î¯Î± Î³Î¹Î± ÏƒÎºÎ¿ÏÎ¬ÏÎ¹ÏƒÎ¼Î±)
                const playerToBallX = ball.x - player.x;
                const playerToBallY = ball.y - player.y;
                const ballToGoalX = goal.x - ball.x;
                const ballToGoalY = goal.y - ball.y;
                
                // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î³Ï‰Î½Î¯Î±Ï‚ player-ball-goal
                const angle1 = Math.atan2(playerToBallY, playerToBallX);
                const angle2 = Math.atan2(ballToGoalY, ballToGoalX);
                let angleDiff = Math.abs(angle1 - angle2);
                if (angleDiff > Math.PI) angleDiff = 2 * Math.PI - angleDiff;
                
                // Î†ÏÎ¹ÏƒÏ„Î· Î³Ï‰Î½Î¯Î± = 180Â° (ÎµÏ…Î¸ÎµÎ¯Î± Î³ÏÎ±Î¼Î¼Î® player-ball-goal)
                const angleScore = Math.max(0.2, 1 - (angleDiff / Math.PI)); // Î¤Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 0.2

                // 3.1d: Weighted sum - Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 0.1 Î³Î¹Î± Î½Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï€Î¬Î½Ï„Î± ÎºÎ¬Ï€Î¿Î¹Î¿Ï‚ score
                const totalScore = Math.max(0.1, (distanceScore * 0.4) + (angleScore * 0.6));
                
                return totalScore;
            }

            // âœ… Phase 4.2: ÎšÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏ„ÏÎ±Ï„Î·Î³Î¹ÎºÎ®Ï‚
            determineStrategy() {
                if (this.botScore < this.playerScore) {
                    return 'aggressive'; // Î§Î¬Î½ÎµÎ¹, Ï€Î¹Î¿ ÎµÏ€Î¹Î¸ÎµÏ„Î¹ÎºÏŒ
                } else if (this.botScore > this.playerScore) {
                    return 'defensive'; // ÎšÎµÏÎ´Î¯Î¶ÎµÎ¹, Ï€Î¹Î¿ Ï€ÏÎ¿ÏƒÎµÎºÏ„Î¹ÎºÏŒ
                } else {
                    return 'balanced'; // Î™ÏƒÎ¿Ï€Î±Î»Î¯Î±
                }
            }

            // âœ… Phase 5.2: Î ÏÏŒÏƒÎ¸ÎµÏƒÎµ Î±Î½Î¸ÏÏÏ€Î¹Î½Î¿ Î»Î¬Î¸Î¿Ï‚
            addHumanError(vx, vy, errorRate) {
                // 15% Ï€Î¹Î¸Î±Î½ÏŒÏ„Î·Ï„Î± Î»Î¬Î¸Î¿Ï…Ï‚
                if (Math.random() > errorRate) {
                    return {vx, vy}; // Î¤Î­Î»ÎµÎ¹Î¿ shot
                }

                // Î ÏÏŒÏƒÎ¸ÎµÏƒÎµ Ï„Ï…Ï‡Î±Î¯Î± Î±Ï€ÏŒÎºÎ»Î¹ÏƒÎ·
                const speed = Math.sqrt(vx * vx + vy * vy);
                const angle = Math.atan2(vy, vx);
                
                // Â±10 degrees Ï„Ï…Ï‡Î±Î¯Î± Î±Ï€ÏŒÎºÎ»Î¹ÏƒÎ·
                const angleError = (Math.random() - 0.5) * (Math.PI / 18); // Â±10Â°
                const newAngle = angle + angleError;
                
                // Â±15% Î±Ï€ÏŒÎºÎ»Î¹ÏƒÎ· ÏƒÏ„Î· Î´ÏÎ½Î±Î¼Î·
                const powerError = 0.85 + Math.random() * 0.3; // 0.85-1.15
                const newSpeed = speed * powerError;
                
                return {
                    vx: Math.cos(newAngle) * newSpeed,
                    vy: Math.sin(newAngle) * newSpeed
                };
            }

            checkTurnComplete() {
                // Î•Î»Î­Î³Ï‡ÎµÎ¹ Î±Î½ ÏŒÎ»Î± Î­Ï‡Î¿Ï…Î½ ÏƒÏ„Î±Î¼Î±Ï„Î®ÏƒÎµÎ¹
                const anyMoving = [...this.playerTeam, ...this.botTeam].some(p => p.moving);
                const ballMoving = Math.abs(this.ball.vx) > 0.1 || Math.abs(this.ball.vy) > 0.1;
                
                if (!anyMoving && !ballMoving && !this.turnComplete) {
                    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ ÎºÎ¬Ï€Î¿Î¹Î¿Ï‚ Ï€Î±Î¯ÎºÏ„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï„Î­ÏÎ¼Î± > 70%
                    this.checkPlayersInGoal();
                    
                    this.turnComplete = true;
                    // Î‘Î»Î»Î±Î³Î® ÏƒÎµÎ¹ÏÎ¬Ï‚
                    this.currentTurn = this.currentTurn === 'player' ? 'bot' : 'player';
                    
                    // ÎœÎµÏ„Î¬ Ï„Î¿ Ï€ÏÏÏ„Î¿ shot, Ï„Î¿ flag Î³Î¯Î½ÎµÏ„Î±Î¹ false
                    if (this.ball.firstShotAfterReset) {
                        this.ball.firstShotAfterReset = false;
                    }
                }
            }

            checkPlayersInGoal() {
                const sideMargin = 240;
                const topMargin = 180;
                const bottomMargin = 80;
                const centerY = (topMargin + (canvas.height - bottomMargin)) / 2;
                const goalHeight = 180;
                const goalTop = centerY - (goalHeight / 2);
                const goalBottom = centerY + (goalHeight / 2);
                const goalWidth = 55;
                
                const allPlayers = [...this.playerTeam, ...this.botTeam];
                
                allPlayers.forEach(player => {
                    let insideGoalPercentage = 0;
                    let targetX, targetY;
                    let inLeftGoal = false;
                    let inRightGoal = false;
                    
                    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±ÏÎ¹ÏƒÏ„ÎµÏÏŒ Ï„Î­ÏÎ¼Î±
                    if (player.x < sideMargin && player.y > goalTop && player.y < goalBottom) {
                        const distanceInside = sideMargin - player.x;
                        insideGoalPercentage = (distanceInside / player.radius) * 100;
                        inLeftGoal = true;
                    }
                    
                    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î´ÎµÎ¾Î¯ Ï„Î­ÏÎ¼Î±
                    if (player.x > canvas.width - sideMargin && player.y > goalTop && player.y < goalBottom) {
                        const distanceInside = player.x - (canvas.width - sideMargin);
                        insideGoalPercentage = (distanceInside / player.radius) * 100;
                        inRightGoal = true;
                    }
                    
                    // Î‘Î½ ÎµÎ¯Î½Î±Î¹ > 70% Î¼Î­ÏƒÎ±, Î²Î³Î¬Î»Îµ Ï„Î¿Î½ Î­Î¾Ï‰ Î¼Îµ animation
                    if (insideGoalPercentage > 70) {
                        // Î¤Ï…Ï‡Î±Î¯Î± Î¸Î­ÏƒÎ· ÏƒÏ„Î·Î½ ÎºÎ¿ÏÏ…Ï†Î® Ï„Î·Ï‚ Î¼ÎµÎ³Î¬Î»Î·Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚
                        const penaltyBoxWidth = 150;
                        const penaltyBoxHeight = 390;
                        
                        if (inLeftGoal) {
                            // Î‘ÏÎ¹ÏƒÏ„ÎµÏÎ® Î¼ÎµÎ³Î¬Î»Î· Ï€ÎµÏÎ¹Î¿Ï‡Î® - ÎºÎ¿ÏÏ…Ï†Î® (Î´ÎµÎ¾Î¹Î¬ Î³ÏÎ±Î¼Î¼Î®)
                            targetX = sideMargin + penaltyBoxWidth;
                            targetY = centerY - penaltyBoxHeight/2 + Math.random() * penaltyBoxHeight;
                        } else if (inRightGoal) {
                            // Î”ÎµÎ¾Î¹Î¬ Î¼ÎµÎ³Î¬Î»Î· Ï€ÎµÏÎ¹Î¿Ï‡Î® - ÎºÎ¿ÏÏ…Ï†Î® (Î±ÏÎ¹ÏƒÏ„ÎµÏÎ® Î³ÏÎ±Î¼Î¼Î®)
                            targetX = canvas.width - sideMargin - penaltyBoxWidth;
                            targetY = centerY - penaltyBoxHeight/2 + Math.random() * penaltyBoxHeight;
                        }
                        
                        // Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· animation
                        player.isRelocating = true;
                        player.relocateTarget = { x: targetX, y: targetY };
                        player.relocateStartTime = Date.now();
                        player.relocateStartPos = { x: player.x, y: player.y };
                    }
                });
            }

            update() {
                // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î¼Î®Î½Ï…Î¼Î± Î³ÎºÎ¿Î»
                if (this.goalMessage) {
                    const elapsed = Date.now() - this.goalMessageTime;
                    if (elapsed >= 2000) {  // 2 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
                        this.goalMessage = null;
                        this.resetPositions();
                        this.turnComplete = true;
                    }
                    return;  // Î”ÎµÎ½ ÎµÎ½Î·Î¼ÎµÏÏÎ½Î¿Ï…Î¼Îµ Ï„Î¯Ï€Î¿Ï„Î± Î¬Î»Î»Î¿ ÏŒÏƒÎ¿ ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ Ï„Î¿ Î¼Î®Î½Ï…Î¼Î±
                }
                
                const goal = this.ball.update();
                
                if (goal === 'player_goal') {
                    this.botScore++;
                    this.goalMessage = 'Î“ÎšÎŸÎ›!\nÎ£ÎºÏŒÏÎ±ÏÎµ Ï„Î¿ BOT!';
                    this.goalMessageTime = Date.now();
                    this.currentTurn = 'player'; // Î‘Ï…Ï„ÏŒÏ‚ Ï€Î¿Ï… Î­Ï†Î±Î³Îµ Î³ÎºÎ¿Î» Ï€Î±Î¯Î¶ÎµÎ¹
                } else if (goal === 'bot_goal') {
                    this.playerScore++;
                    this.goalMessage = 'Î“ÎšÎŸÎ›!\nÎ£ÎºÏŒÏÎ±ÏÎµÏ‚!';
                    this.goalMessageTime = Date.now();
                    this.currentTurn = 'bot'; // Î‘Ï…Ï„ÏŒÏ‚ Ï€Î¿Ï… Î­Ï†Î±Î³Îµ Î³ÎºÎ¿Î» Ï€Î±Î¯Î¶ÎµÎ¹
                } else if (goal === 'foul_player_goal') {
                    // Î¦Î‘ÎŸÎ¥Î›! Î¤Î¿ bot Ï€ÏÎ¿ÏƒÏ€Î¬Î¸Î·ÏƒÎµ Î½Î± ÏƒÎºÎ¿ÏÎ¬ÏÎµÎ¹ Î±Ï€ÏŒ Ï„Î¿ ÎºÎ­Î½Ï„ÏÎ¿
                    this.goalMessage = 'Î¦Î‘ÎŸÎ¥Î›!\nÎ”ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÏƒÎºÎ¿ÏÎ¬ÏÎµÎ¹Ï‚\nÎ±Ï€ÏŒ Ï„Î¿ ÎºÎ­Î½Ï„ÏÎ¿!';
                    this.goalMessageTime = Date.now();
                    this.currentTurn = 'player'; // Î Î±Î¯Î¶ÎµÎ¹ Î¿ player
                } else if (goal === 'foul_bot_goal') {
                    // Î¦Î‘ÎŸÎ¥Î›! ÎŸ player Ï€ÏÎ¿ÏƒÏ€Î¬Î¸Î·ÏƒÎµ Î½Î± ÏƒÎºÎ¿ÏÎ¬ÏÎµÎ¹ Î±Ï€ÏŒ Ï„Î¿ ÎºÎ­Î½Ï„ÏÎ¿
                    this.goalMessage = 'Î¦Î‘ÎŸÎ¥Î›!\nÎ”ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÏƒÎºÎ¿ÏÎ¬ÏÎµÎ¹Ï‚\nÎ±Ï€ÏŒ Ï„Î¿ ÎºÎ­Î½Ï„ÏÎ¿!';
                    this.goalMessageTime = Date.now();
                    this.currentTurn = 'bot'; // Î Î±Î¯Î¶ÎµÎ¹ Î¿ bot
                }

                // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï„ÎµÎ»ÎµÎ¯Ï‰ÏƒÎµ Î· ÏƒÎµÎ¹ÏÎ¬
                this.checkTurnComplete();
                
                // Bot ÎºÎ¯Î½Î·ÏƒÎ·
                this.botMove();

                // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï€Î±Î¹ÎºÏ„ÏÎ½
                const allPlayers = [...this.playerTeam, ...this.botTeam];
                allPlayers.forEach(player => {
                    player.update();
                    player.checkCollision(this.ball);
                    
                    // Collision Î¼Îµ Î´Î¿ÎºÎ¬ÏÎ¹Î±
                    this.goalPosts.forEach(post => {
                        this.checkGoalPostCollision(player, post);
                    });
                });
                
                // Collision Î¼Ï€Î¬Î»Î±Ï‚ Î¼Îµ Î´Î¿ÎºÎ¬ÏÎ¹Î±
                this.goalPosts.forEach(post => {
                    this.checkBallGoalPostCollision(this.ball, post);
                });
                
                // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÏƒÏ…Î³ÎºÏÎ¿ÏÏƒÎµÏ‰Î½ Î¼ÎµÏ„Î±Î¾Ï Ï€Î±Î¹ÎºÏ„ÏÎ½
                for (let i = 0; i < allPlayers.length; i++) {
                    for (let j = i + 1; j < allPlayers.length; j++) {
                        allPlayers[i].checkPlayerCollision(allPlayers[j]);
                    }
                }
            }

            checkGoalPostCollision(player, post) {
                const dx = player.x - post.x;
                const dy = player.y - post.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const minDistance = player.radius + post.radius;
                
                if (distance < minDistance && distance > 0) {
                    // Î§Ï‰ÏÎ¹ÏƒÎ¼ÏŒÏ‚
                    const angle = Math.atan2(dy, dx);
                    const overlap = minDistance - distance;
                    
                    player.x += Math.cos(angle) * (overlap + 2);
                    player.y += Math.sin(angle) * (overlap + 2);
                    
                    // Bounce
                    const relVelocity = player.vx * Math.cos(angle) + player.vy * Math.sin(angle);
                    if (relVelocity < 0) {
                        player.vx -= 1.5 * relVelocity * Math.cos(angle);
                        player.vy -= 1.5 * relVelocity * Math.sin(angle);
                    }
                }
            }

            checkBallGoalPostCollision(ball, post) {
                const dx = ball.x - post.x;
                const dy = ball.y - post.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const minDistance = ball.radius + post.radius;
                
                if (distance < minDistance && distance > 0) {
                    // Î§Ï‰ÏÎ¹ÏƒÎ¼ÏŒÏ‚
                    const angle = Math.atan2(dy, dx);
                    const overlap = minDistance - distance;
                    
                    ball.x += Math.cos(angle) * (overlap + 2);
                    ball.y += Math.sin(angle) * (overlap + 2);
                    
                    // Bounce Î¼Îµ restitution
                    const relVelocity = ball.vx * Math.cos(angle) + ball.vy * Math.sin(angle);
                    if (relVelocity < 0) {
                        const restitution = 0.7;  // Î§Î¬Î½ÎµÎ¹ Î»Î¯Î³Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±
                        ball.vx -= (1 + restitution) * relVelocity * Math.cos(angle);
                        ball.vy -= (1 + restitution) * relVelocity * Math.sin(angle);
                    }
                }
            }

            draw() {
                this.drawField();
                
                // Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎ· Ï„Î±Î¼Ï€Î­Î»Î±Ï‚ ÏƒÎºÎ¿Ï Ï€ÏÏÏ„Î± (Ï€Î¯ÏƒÏ‰ Î±Ï€ÏŒ Ï„Î¿ Î³Î®Ï€ÎµÎ´Î¿ Î±Î»Î»Î¬ ÎµÎ¼Ï†Î±Î½Î®Ï‚)
                this.drawScoreboard();
                
                // Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎ· Î³ÏÎ±Î¼Î¼Î®Ï‚ slingshot Î±Î½ Ï„ÏÎ±Î²Î¹Î­Ï„Î±Î¹
                if (this.selectedPlayer && this.dragStart && this.currentDrag) {
                    const dx = this.dragStart.x - this.currentDrag.x;
                    const dy = this.dragStart.y - this.currentDrag.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    // ÎœÎ­Î³Î¹ÏƒÏ„Î· Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ· ÎºÎ±Î¹ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ® Î´ÏÎ½Î±Î¼Î·
                    const maxDragDistance = 200;
                    const actualDistance = Math.min(distance, maxDragDistance);
                    const power = (actualDistance / maxDragDistance) * 100; // 0-100%
                    
                    // Î“ÏÎ±Î¼Î¼Î® ÏƒÏ†ÎµÎ½Ï„ÏŒÎ½Î±Ï‚ - Î Î¹Î¿ Ï€Î±Ï‡Î¹Î¬
                    ctx.beginPath();
                    ctx.moveTo(this.selectedPlayer.x, this.selectedPlayer.y);
                    ctx.lineTo(this.currentDrag.x, this.currentDrag.y);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
                    ctx.lineWidth = 5;
                    ctx.stroke();
                    
                    // Î’Î­Î»Î¿Ï‚ Ï€Î¿Ï… Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ Ï„Î·Î½ ÎºÎ±Ï„ÎµÏÎ¸Ï…Î½ÏƒÎ· ÎµÎºÏ„ÏŒÎ¾ÎµÏ…ÏƒÎ·Ï‚ - Î£Ï…Î½ÎµÏ€Î­Ï‚ Î¼Î®ÎºÎ¿Ï‚
                    const arrowLength = actualDistance * 1.0; // Î¤Î¿ Î²Î­Î»Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ Î±Î½Î¬Î»Î¿Î³Î¿ Ï„Î·Ï‚ Î´ÏÎ½Î±Î¼Î·Ï‚
                    const angle = Math.atan2(-dy, -dx);
                    const arrowX = this.selectedPlayer.x + Math.cos(angle) * arrowLength;
                    const arrowY = this.selectedPlayer.y + Math.sin(angle) * arrowLength;
                    
                    // Î’Î­Î»Î¿Ï‚ Î¼Îµ gradient - Ï‡ÏÏÎ¼Î± Î±Î½Î¬Î»Î¿Î³Î¿ Ï„Î·Ï‚ Î´ÏÎ½Î±Î¼Î·Ï‚
                    const gradient = ctx.createLinearGradient(
                        this.selectedPlayer.x, this.selectedPlayer.y,
                        arrowX, arrowY
                    );
                    
                    if (power < 33) {
                        gradient.addColorStop(0, 'rgba(100, 255, 100, 1)'); // Î ÏÎ¬ÏƒÎ¹Î½Î¿ = Ï‡Î±Î¼Î·Î»Î® Î´ÏÎ½Î±Î¼Î·
                        gradient.addColorStop(1, 'rgba(255, 255, 100, 1)');
                    } else if (power < 66) {
                        gradient.addColorStop(0, 'rgba(255, 255, 100, 1)'); // ÎšÎ¯Ï„ÏÎ¹Î½Î¿ = Î¼ÎµÏƒÎ±Î¯Î± Î´ÏÎ½Î±Î¼Î·
                        gradient.addColorStop(1, 'rgba(255, 200, 0, 1)');
                    } else {
                        gradient.addColorStop(0, 'rgba(255, 200, 0, 1)'); // Î Î¿ÏÏ„Î¿ÎºÎ±Î»Î¯/ÎšÏŒÎºÎºÎ¹Î½Î¿ = Ï…ÏˆÎ·Î»Î® Î´ÏÎ½Î±Î¼Î·
                        gradient.addColorStop(1, 'rgba(255, 100, 0, 1)');
                    }
                    
                    ctx.beginPath();
                    ctx.moveTo(this.selectedPlayer.x, this.selectedPlayer.y);
                    ctx.lineTo(arrowX, arrowY);
                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = 8;
                    ctx.stroke();
                    
                    // ÎšÎµÏ†Î¬Î»Î¹ Î²Î­Î»Î¿Ï…Ï‚ - ÎœÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿
                    const arrowHeadSize = 20;
                    ctx.beginPath();
                    ctx.moveTo(arrowX, arrowY);
                    ctx.lineTo(
                        arrowX - arrowHeadSize * Math.cos(angle - Math.PI / 6),
                        arrowY - arrowHeadSize * Math.sin(angle - Math.PI / 6)
                    );
                    ctx.moveTo(arrowX, arrowY);
                    ctx.lineTo(
                        arrowX - arrowHeadSize * Math.cos(angle + Math.PI / 6),
                        arrowY - arrowHeadSize * Math.sin(angle + Math.PI / 6)
                    );
                    ctx.strokeStyle = power > 66 ? 'rgba(255, 100, 0, 1)' : 'rgba(255, 200, 0, 1)';
                    ctx.lineWidth = 8;
                    ctx.stroke();
                    
                    // Î”ÎµÎ¯ÎºÏ„Î·Ï‚ Î´ÏÎ½Î±Î¼Î·Ï‚ - Î‘ÎšÎ¡Î™Î’Î—Î£ Ï€Î¿ÏƒÎ¿ÏƒÏ„ÏŒ
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                    ctx.font = 'bold 32px Arial';
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.8)';
                    ctx.lineWidth = 3;
                    const powerText = `${Math.floor(power)}%`;
                    ctx.strokeText(powerText, this.currentDrag.x + 30, this.currentDrag.y - 30);
                    ctx.fillText(powerText, this.currentDrag.x + 30, this.currentDrag.y - 30);
                    
                    // Î ÏÎ¿ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î±Î½ Î­Ï†Ï„Î±ÏƒÎµÏ‚ Ï„Î¿ Î¼Î­Î³Î¹ÏƒÏ„Î¿
                    if (distance >= maxDragDistance) {
                        ctx.fillStyle = 'rgba(255, 50, 50, 0.95)';
                        ctx.font = 'bold 24px Arial';
                        ctx.strokeText('MAX!', this.currentDrag.x + 30, this.currentDrag.y - 65);
                        ctx.fillText('MAX!', this.currentDrag.x + 30, this.currentDrag.y - 65);
                    }
                }
                
                this.botTeam.forEach(p => p.draw());
                this.playerTeam.forEach(p => p.draw());
                
                this.ball.draw();
                
                // Î”ÎŸÎšÎ‘Î¡Î™Î‘ - Î¤Î•Î›Î•Î¥Î¤Î‘Î™Î‘ Î Î¡Î‘Î“ÎœÎ‘Î¤Î‘ Î ÎŸÎ¥ Î£Î§Î•Î”Î™Î‘Î–ÎŸÎÎ¤Î‘Î™ (Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ ÎŸÎ›Î‘)
                const sideMargin2 = 240;
                const topMargin2 = 180;
                const bottomMargin2 = 80;
                const centerY2 = (topMargin2 + (canvas.height - bottomMargin2)) / 2;
                
                // Î‘ÏÎ¹ÏƒÏ„ÎµÏÎ¬ (ÎœÎ Î›Î•)
                this.drawGoalPost(sideMargin2, centerY2 - 90, 8, '#2745e1');
                this.drawGoalPost(sideMargin2, centerY2 + 90, 8, '#2745e1');
                // Î”ÎµÎ¾Î¹Î¬ (ÎšÎŸÎšÎšÎ™ÎÎ‘)
                this.drawGoalPost(canvas.width - sideMargin2, centerY2 - 90, 8, '#ff3420');
                this.drawGoalPost(canvas.width - sideMargin2, centerY2 + 90, 8, '#ff3420');
                
                // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î¼Î·Î½ÏÎ¼Î±Ï„Î¿Ï‚ Î³ÎºÎ¿Î» Î® Ï†Î¬Î¿Ï…Î»
                if (this.goalMessage) {
                    // Î£ÎºÎ¿Ï„ÎµÎ¹Î½ÏŒ overlay
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    const lines = this.goalMessage.split('\n');
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ ÎµÎ¯Î½Î±Î¹ Î¦Î‘ÎŸÎ¥Î› Î® Î“ÎšÎŸÎ›
                    const isFoul = lines[0] === 'Î¦Î‘ÎŸÎ¥Î›!';
                    
                    // Î ÏÏÏ„Î· Î³ÏÎ±Î¼Î¼Î® - Î“ÎšÎŸÎ› Î® Î¦Î‘ÎŸÎ¥Î›
                    ctx.font = 'bold 120px Arial';
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.8)';
                    ctx.lineWidth = 8;
                    ctx.strokeText(lines[0], canvas.width / 2, canvas.height / 2 - 60);
                    
                    if (isFoul) {
                        // Î¦Î‘ÎŸÎ¥Î› - ÎšÏŒÎºÎºÎ¹Î½Î¿ gradient
                        const foulGradient = ctx.createLinearGradient(0, canvas.height / 2 - 120, 0, canvas.height / 2);
                        foulGradient.addColorStop(0, '#FF0000');
                        foulGradient.addColorStop(1, '#CC0000');
                        ctx.fillStyle = foulGradient;
                        ctx.fillText(lines[0], canvas.width / 2, canvas.height / 2 - 60);
                    } else {
                        // Î“ÎšÎŸÎ› - Î§ÏÏ…ÏƒÏŒ gradient
                        const goalGradient = ctx.createLinearGradient(0, canvas.height / 2 - 120, 0, canvas.height / 2);
                        goalGradient.addColorStop(0, '#FFD700');
                        goalGradient.addColorStop(1, '#FFA500');
                        ctx.fillStyle = goalGradient;
                        ctx.fillText(lines[0], canvas.width / 2, canvas.height / 2 - 60);
                    }
                    
                    // Î¥Ï€ÏŒÎ»Î¿Î¹Ï€ÎµÏ‚ Î³ÏÎ±Î¼Î¼Î­Ï‚
                    for (let i = 1; i < lines.length; i++) {
                        const yOffset = 60 + ((i - 1) * 55);
                        ctx.font = i === 1 ? 'bold 48px Arial' : 'bold 38px Arial';
                        ctx.strokeStyle = 'rgba(0, 0, 0, 0.8)';
                        ctx.lineWidth = 5;
                        ctx.strokeText(lines[i], canvas.width / 2, canvas.height / 2 + yOffset);
                        ctx.fillStyle = isFoul ? '#FFB0B0' : '#FFFFFF';
                        ctx.fillText(lines[i], canvas.width / 2, canvas.height / 2 + yOffset);
                    }
                    
                    ctx.textAlign = 'left';
                    ctx.textBaseline = 'alphabetic';
                }
            }

            loop() {
                this.update();
                this.draw();
                requestAnimationFrame(() => this.loop());
            }
        }

        // roundRect polyfill
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
                this.beginPath();
                this.moveTo(x + r, y);
                this.lineTo(x + w - r, y);
                this.quadraticCurveTo(x + w, y, x + w, y + r);
                this.lineTo(x + w, y + h - r);
                this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
                this.lineTo(x + r, y + h);
                this.quadraticCurveTo(x, y + h, x, y + h - r);
                this.lineTo(x, y + r);
                this.quadraticCurveTo(x, y, x + r, y);
                this.closePath();
                return this;
            };
        }

        // Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Ï€Î¿Ï… Î¾ÎµÎºÎ¹Î½Î¬ÎµÎ¹ Ï„Î¿ Ï€Î±Î¹Ï‡Î½Î¯Î´Î¹
        function startGame() {
            console.log('Starting game...');
            const game = new Game();
            game.loop();
        }
        
        // Î”Î•Î Î¾ÎµÎºÎ¹Î½Î¬Î¼Îµ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ - Î ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î¼Îµ Ï„Î¹Ï‚ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚!
    </script>
</body>
</html>
